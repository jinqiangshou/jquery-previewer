/**
 * jquery.previewer.js - v1.0.0 - 2016-03-17
 * https://github.com/jinqiangshou/jquery-previewer
 * Copyright (c) 2016 Horst Xu
 * Licensed MIT (http://www.opensource.org/licenses/mit-license.php)
 */
!function(e,t,i){"use strict";var o={browserType:function(){var e=navigator.userAgent.toLowerCase(),t=/msie/.test(e)?"ie":/firefox/.test(e)?"firefox":/opera/.test(e)?"opera":/chrome/.test(e)?"chrome":/safari/.test(e)?"safari":"";return t}(),getWindowSize:function(){var e={};return e.winWidth=t.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||1,e.winHeight=t.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||1,e},stringEncode:function(){var e=document.createElement("div");return function(t){return e.innerHTML="",e.appendChild(document.createTextNode(t)),e.innerHTML}}(),domAppend:function(t,i,o){var n=t.clientX-1,r=t.clientY-1,c=o.css({position:"fixed","z-index":99999,left:n,top:r}).append(i);e(t.target).append(c)},imagePreload:function(e){var t=new Image;t.src=e,t.onload=function(){}},applyCSS:function(e,t){"object"==typeof e&&t.css(e)},resetDiv:function(e){e.empty(),e.remove()},getVideoRealSize:function(t){var i={};return e(t).attr("height")?i.height=parseInt(e(t).attr("height")):i.height=parseInt(t.videoHeight),e(t).attr("width")?i.width=parseInt(e(t).attr("width")):i.width=parseInt(t.videoWidth),i},adjustPosition:function(e,t){var i=this.getWindowSize(),o=i.winWidth,n=i.winHeight,r=t?this.getVideoRealSize(t):{height:0,width:0},c=t?r.height:parseInt(e.css("height")),s=t?r.width:parseInt(e.css("width")),a=parseInt(e.css("left")),d=parseInt(e.css("top"));d+c>n&&e.css({top:n-c-30+"px"}),a+s>o&&e.css({left:o-s-30+"px"})},resizeImage:function(e){var t=this.getWindowSize(),i=t.winWidth,o=t.winHeight,n=parseInt(e.css("height"))||1,r=parseInt(e.css("width"))||1,c=.5*o,s=0;n>c&&(s=c/n*r,e.css({height:c+"px",width:s+"px"}),n=c||1,r=s||1);var a=.7*i,d=0;return r>a&&(d=a/r*n,e.css({height:d+"px",width:a+"px"}),r=a,n=d),{imgWidth:r,imgHeight:n}},resizeVideo:function(e){var t=this.getWindowSize(),i=t.winWidth,o=t.winHeight,n=e[0].videoWidth,r=e[0].videoHeight,c=.5*o,s=0;r>c&&(s=c/r*n,e.attr("height",c+"px"),e.attr("width",s+"px"),r=c||1,n=s||1);var a=.7*i,d=0;return n>a&&(d=a/n*r,e.attr("height",d+"px"),e.attr("width",a+"px"),n=a,r=d),{videoWidth:n,videoHeight:r}}},n=function(t,i){this.showFlag=!1,this.container=t,this.cbFunction=null;var o=e("<div>");this.options=e.extend({type:"image",src:"",trigger:"click",text:"",beforeShow:function(){},onShow:function(){},containerCSS:{border:"1px solid #999","background-color":"#FFEE88","border-radius":"5px",padding:"6px"}},i,{div:o}),this.init()};n.prototype.init=function(){var t=this;switch(o.applyCSS(t.options.containerCSS,t.options.div),t.options.type){case"image":t.initImagePreview();break;case"text":t.initTextPreview();break;case"video":t.initVideoPreview()}e(t.container).on(t.options.trigger,function(e){"function"==typeof t.options.beforeShow&&t.options.beforeShow.call(t.container),t.cbFunction.call(t,e,t.options),"function"==typeof t.options.onShow&&t.options.onShow.call(t.container,t.options.div[0])})},n.prototype.initTextPreview=function(){var e=this;switch(e.options.trigger){case"click":e.cbFunction=e.clickTextCb;break;case"hover":e.options.trigger="mouseenter",e.cbFunction=e.hoverTextCb;break;default:e.options.trigger="click",e.cbFunction=e.clickTextCb}},n.prototype.clickTextCb=function(t,i){var n=this;i.div.css({"max-width":"400px"});var r=e("<p>");r.css({"word-break":"normal","word-wrap":"break-word"}),r.text(i.text),o.resetDiv(i.div),o.domAppend(t,r,i.div),o.adjustPosition(i.div),n.showFlag=!0,i.div.one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(e(n.container).off("mouseleave"),o.resetDiv(i.div))},200)}),e(n.container).one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(i.div.off("mouseleave"),o.resetDiv(i.div))},200)})},n.prototype.hoverTextCb=function(e,t){var i=this;i.clickTextCb(e,t)},n.prototype.initImagePreview=function(){var e=this;switch(e.options.trigger){case"click":e.cbFunction=e.clickImageCb;break;case"hover":e.options.trigger="mouseenter",e.cbFunction=e.hoverImageCb;break;default:e.options.trigger="click",e.cbFunction=e.clickImageCb}o.imagePreload(e.options.src)},n.prototype.clickImageCb=function(t,i){var n=this,r=new Image;r.src=n.options.src,o.resetDiv(i.div),r.onload=function(){o.domAppend(t,e(r),i.div),o.resizeImage(e(r)),o.adjustPosition(i.div),n.showFlag=!0},i.div.one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(e(n.container).off("mouseleave"),o.resetDiv(i.div))},200)}),e(n.container).one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(i.div.off("mouseleave"),o.resetDiv(i.div))},200)})},n.prototype.hoverImageCb=function(e,t){var i=this;i.clickImageCb(e,t)},n.prototype.initVideoPreview=function(){var e=this;switch(e.options.trigger){case"click":e.cbFunction=e.clickVideoCb;break;case"hover":e.options.trigger="mouseenter",e.cbFunction=e.hoverVideoCb;break;default:e.options.trigger="click",e.cbFunction=e.clickVideoCb}},n.prototype.clickVideoCb=function(t,i){var n=this,r=e("<video>").attr("src",i.src).attr("controls","controls").attr("autoplay","autoplay");r.one("playing",function(){o.resizeVideo(e(this)),o.adjustPosition(i.div,this)}),o.resetDiv(i.div),o.domAppend(t,r,i.div),n.showFlag=!0,i.div.one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(e(n.container).off("mouseleave"),o.resetDiv(i.div))},200)}),e(n.container).one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(i.div.off("mouseleave"),o.resetDiv(i.div))},200)})},n.prototype.hoverVideoCb=function(e,t){var i=this;i.clickVideoCb(e,t)},e.fn.previewer=function(e){return this.each(function(){new n(this,e)})}}(jQuery,window);