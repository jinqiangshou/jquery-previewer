/**
 * jquery.previewer.js - v1.0.2 - 2016-03-17
 * https://github.com/jinqiangshou/jquery-previewer
 * Copyright (c) 2016 Horst Xu
 * Licensed MIT (http://www.opensource.org/licenses/mit-license.php)
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var t={browserType:function(){var e=navigator.userAgent.toLowerCase(),t=/msie/.test(e)?"ie":/firefox/.test(e)?"firefox":/opera/.test(e)?"opera":/chrome/.test(e)?"chrome":/safari/.test(e)?"safari":"";return t}(),getWindowSize:function(){var e={};return e.winWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||1,e.winHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||1,e},stringEncode:function(){var e=document.createElement("div");return function(t){return e.innerHTML="",e.appendChild(document.createTextNode(t)),e.innerHTML}}(),domAppend:function(t,i,o){var n=t.clientX-1,r=t.clientY-1,c=o.css({position:"fixed","z-index":99999,left:n,top:r}).append(i);e(t.target).append(c)},imagePreload:function(e){var t=new Image;t.src=e,t.onload=function(){}},applyCSS:function(e,t){"object"==typeof e&&t.css(e)},resetDiv:function(e){e.empty(),e.remove()},getVideoRealSize:function(t){var i={};return e(t).attr("height")?i.height=parseInt(e(t).attr("height")):i.height=parseInt(t.videoHeight),e(t).attr("width")?i.width=parseInt(e(t).attr("width")):i.width=parseInt(t.videoWidth),i},adjustPosition:function(e,t){var i=this.getWindowSize(),o=i.winWidth,n=i.winHeight,r=t?this.getVideoRealSize(t):{height:0,width:0},c=t?r.height:parseInt(e.css("height")),s=t?r.width:parseInt(e.css("width")),a=parseInt(e.css("left")),d=parseInt(e.css("top"));d+c>n&&e.css({top:n-c-30+"px"}),a+s>o&&e.css({left:o-s-30+"px"})},resizeImage:function(e){var t=this.getWindowSize(),i=t.winWidth,o=t.winHeight,n=parseInt(e.css("height"))||1,r=parseInt(e.css("width"))||1,c=.5*o,s=0;n>c&&(s=c/n*r,e.css({height:c+"px",width:s+"px"}),n=c||1,r=s||1);var a=.7*i,d=0;return r>a&&(d=a/r*n,e.css({height:d+"px",width:a+"px"}),r=a,n=d),{imgWidth:r,imgHeight:n}},resizeVideo:function(e){var t=this.getWindowSize(),i=t.winWidth,o=t.winHeight,n=e[0].videoWidth,r=e[0].videoHeight,c=.5*o,s=0;r>c&&(s=c/r*n,e.attr("height",c+"px"),e.attr("width",s+"px"),r=c||1,n=s||1);var a=.7*i,d=0;return n>a&&(d=a/n*r,e.attr("height",d+"px"),e.attr("width",a+"px"),n=a,r=d),{videoWidth:n,videoHeight:r}}},i=function(t,i){this.showFlag=!1,this.container=t,this.cbFunction=null;var o=e("<div>");this.options=e.extend({type:"image",src:"",trigger:"click",text:"",beforeShow:function(){},onShow:function(){},containerCSS:{border:"1px solid #999","background-color":"#FFEE88","border-radius":"5px",padding:"6px"}},i,{div:o}),this.init()};i.prototype.init=function(){var i=this;switch(t.applyCSS(i.options.containerCSS,i.options.div),i.options.type){case"image":i.initImagePreview();break;case"text":i.initTextPreview();break;case"video":i.initVideoPreview()}e(i.container).on(i.options.trigger,function(e){"function"==typeof i.options.beforeShow&&i.options.beforeShow.call(i.container),i.cbFunction.call(i,e,i.options),"function"==typeof i.options.onShow&&i.options.onShow.call(i.container,i.options.div[0])})},i.prototype.initTextPreview=function(){var e=this;switch(e.options.trigger){case"click":e.cbFunction=e.clickTextCb;break;case"hover":e.options.trigger="mouseenter",e.cbFunction=e.hoverTextCb;break;default:e.options.trigger="click",e.cbFunction=e.clickTextCb}},i.prototype.clickTextCb=function(i,o){var n=this;o.div.css({"max-width":"400px"});var r=e("<p>");r.css({"word-break":"normal","word-wrap":"break-word"}),r.text(o.text),t.resetDiv(o.div),t.domAppend(i,r,o.div),t.adjustPosition(o.div),n.showFlag=!0,o.div.one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(e(n.container).off("mouseleave"),t.resetDiv(o.div))},200)}),e(n.container).one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(o.div.off("mouseleave"),t.resetDiv(o.div))},200)})},i.prototype.hoverTextCb=function(e,t){var i=this;i.clickTextCb(e,t)},i.prototype.initImagePreview=function(){var e=this;switch(e.options.trigger){case"click":e.cbFunction=e.clickImageCb;break;case"hover":e.options.trigger="mouseenter",e.cbFunction=e.hoverImageCb;break;default:e.options.trigger="click",e.cbFunction=e.clickImageCb}t.imagePreload(e.options.src)},i.prototype.clickImageCb=function(i,o){var n=this,r=new Image;r.src=n.options.src,t.resetDiv(o.div),r.onload=function(){t.domAppend(i,e(r),o.div),t.resizeImage(e(r)),t.adjustPosition(o.div),n.showFlag=!0},o.div.one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(e(n.container).off("mouseleave"),t.resetDiv(o.div))},200)}),e(n.container).one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(o.div.off("mouseleave"),t.resetDiv(o.div))},200)})},i.prototype.hoverImageCb=function(e,t){var i=this;i.clickImageCb(e,t)},i.prototype.initVideoPreview=function(){var e=this;switch(e.options.trigger){case"click":e.cbFunction=e.clickVideoCb;break;case"hover":e.options.trigger="mouseenter",e.cbFunction=e.hoverVideoCb;break;default:e.options.trigger="click",e.cbFunction=e.clickVideoCb}},i.prototype.clickVideoCb=function(i,o){var n=this,r=e("<video>").attr("src",o.src).attr("controls","controls").attr("autoplay","autoplay");r.one("playing",function(){t.resizeVideo(e(this)),t.adjustPosition(o.div,this)}),t.resetDiv(o.div),t.domAppend(i,r,o.div),n.showFlag=!0,o.div.one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(e(n.container).off("mouseleave"),t.resetDiv(o.div))},200)}),e(n.container).one("mouseleave",function(){n.showFlag=!1,setTimeout(function(){n.showFlag||(o.div.off("mouseleave"),t.resetDiv(o.div))},200)})},i.prototype.hoverVideoCb=function(e,t){var i=this;i.clickVideoCb(e,t)},e.fn.previewer=function(e){return this.each(function(){new i(this,e)})}});